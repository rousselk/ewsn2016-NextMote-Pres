\documentclass[10pt,c]{beamer}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%                               80 COLONNES                                %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% THÈME DE LA PRÉSENTATION
\usetheme{JuanLesPins}  %% Warsaw

%%% ÉLÉMENTS DE TITRE
\title{Using Cooja for WSN Simulations: Some New Uses and Limits}
\author{Kévin Roussel \and Ye-Qiong Song \and Olivier Zendra}
\institute{INRIA Nancy Grand-Est~---
           LORIA UMR~7503~--- Université de Lorraine}
\date{EWSN'2016 NextMote workshop\\
      \textit{15 February 2016}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%                               80 COLONNES                                %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% COMMANDES UTILES AU COURS DU CORPS DE TEXTE

\renewcommand{\emph}[1]{\textbf{\textit{#1}}}
\newcommand{\nom}[1]{\textbf{#1}}

\setbeamertemplate{itemize item}[square]
\setbeamertemplate{itemize subitem}[triangle]
\setbeamertemplate{itemize subsubitem}[circle]


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%                               80 COLONNES                                %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% DÉBUT DE LA PRÉSENTATION
\begin{document}

%%% TITRE
\begin{frame}
\titlepage
\end{frame}

%%% SOMMAIRE GÉNÉRAL

\begin{frame}
\frametitle{Contents}
\tableofcontents
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}

\begin{frame}
\frametitle{Introduction (1/2)}
\begin{block}{To develop and test large, ambitious WSN-based projects}
$\rightarrow$ need of powerful and accurate simulation/emulation tools
\end{block}
\begin{block}{Many such simulation/emulation tools exist}
\begin{itemize}
\item OpenSim (from OpenWSN project)
\item TOSSIM (from TinyOS project)
\item Cooja (from Contiki OS project)
\end{itemize}
\end{block}
\begin{exampleblock}{This work focus on the latter framework: \nom{Cooja}}
$\rightarrow$ (one of) the most used simulation/emulation tool
\end{exampleblock}
\end{frame}

\begin{frame}
\frametitle{Introduction (2/2)}
\begin{block}{The present work focus on the two following subjects}
\begin{enumerate}
\item The ability---\emph{actually tested and used}---to use the Cooja
framework to simulate/emulate systems not related to Contiki OS
\item The inaccuracies in time-related results we discovered while using
Cooja\footnote{Note we always used the Cooja version provided with
Contiki release 2.7} to perform our own simulations to test our own
WSN-related projects
\end{enumerate}
\end{block}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Cooja and MSPSim}

\begin{frame}
\frametitle{The Cooja framework and its emulators (1/2)}
\begin{block}{The Cooja application}
It's a Java-based application, providing three main features:
\begin{enumerate}
\item a graphical user interface (GUI) fo the simulation work
\item simulation of the radio medium underlying WSN communications
(IEEE 802.15.4 standard)
\item an extensible framework, allowing integration of additional
Java-based tools to the application
\end{enumerate}
$\rightarrow$ this latest feature allow Cooja to embed emulators,
and thus to actually \emph{emulate} WSN motes
\end{block}
\end{frame}

\begin{frame}
\frametitle{The Cooja framework and its emulators (2/2)}
\begin{exampleblock}{The embedded emulators}
These are currently two:
\begin{enumerate}
\item \nom{Avrora}, for emulation of Atmel AVR-based devices
\item \nom{MSPSim}, for emulation of TI MSP430-based devices
\end{enumerate}
$\rightarrow$ \nom{MSPSim} is currently the most used, since
MSP430-based motes are more commonly used. \emph{The present work
focuses on Cooja and the MSPSim emulator only.}
\end{exampleblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Using Cooja and MSPSim: Not Only for Contiki!}

\begin{frame}
\frametitle{Using Cooja and MSPSim with any WSN system\ldots \\
            (or even without)}
\begin{block}{What do Cooja's embedded emulators run?}
\small
The Contiki build system produces standard (ELF format) executables \\
$\rightarrow$ the Cooja embedded emulators are designed to run such
standard executables
\end{block}
\begin{exampleblock}{What does it mean?}
\small
\emph{Any system producing such standard ELF executables (besides Contiki
OS itself) will run on virtual motes emulated with the Cooja framework}

We tested this with MSPSim, using:
\begin{itemize}
\item applications based on RIOT OS
\item ``bare-metal'' applications
\end{itemize}

Any other OS using \texttt{msp430-gcc} as its compiler (e.g.: TinyOS)
should run fine on Cooja/MSPSim: a simple trick on executables' file
extension is enough
\end{exampleblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Timing Inaccuracy Problem in MSPSim}

\begin{frame}
\frametitle{Timing Inaccuracy Problem in MSPSim: the Setup}
\begin{alertblock}{What did we discover during our experiments?}
\begin{itemize}
\item unexplained delays during simulations/emulations of packet
transmissions (TX), not observed on real hardware
\item the differences appear on one peculiar operation: \emph{when loading
the TX buffer of the CC2420 radio transceiver} {\small(used by both our
hardware platforms: Sky/TelosB and Zolertia Z1 motes)}
\end{itemize}
\end{alertblock}
\begin{block}{What did we do to investigate that problem?}
\begin{itemize}
\item we wrote a simple test program, which only send data packets of
various sizes (resp. 30, 60 and 110 bytes of MAC payload)
\item we tried this program on various configurations:
  \begin{itemize}
  \item two different hardware platforms: Sky/TelosB and Zolertia Z1 motes
  \item two different WSN OS: Contiki and RIOT OS
  \item on RIOT OS: two different way to handle SPI data transfers
        (so-called ``safe mode'' and ``fast mode'')
  \end{itemize}
\end{itemize}
\end{block}
\end{frame}

\begin{frame}
\frametitle{Timing Inaccuracy Problem in MSPSim: the Results}
\begin{block}{What did our tests show?}
\begin{itemize}
\item the inaccuracy problem is mainly influenced by the emulated hardware
platform
  \begin{itemize}
  \item \emph{on Zolertia Z1 motes, timing inaccuracies are catastrophic:
  delays are overestimated by amounts from 95\% to 185\%}
  \item on Sky/TelosB motes, timing inaccuracies are much less important:
  delays are under- or overestimated by amounts up to 18\%
  \end{itemize}
\item the used OS has much less influence on the problem: results tend
to be a little bit more accurate on Contiki than on RIOT OS
\item the SPI method only has a significative influence on Sky/TelosB
hardware, where the inaccuracies almost disappear when using the ``fast
mode'' under RIOT OS
\item \emph{This TX buffer loading operation amounts to about half
of the total packet transmission time under RIOT OS} (much less on
Contiki, where it represents 10\% to 13\%)
\end{itemize}
\end{block}
\end{frame}

\begin{frame}
\frametitle{Timing Inaccuracy Problem in MSPSim: Assumptions}
\vspace{-0.25cm}
\begin{alertblock}{What can we deduce from these results?}
\begin{itemize}
\item \emph{Cooja/MSPSim simulation/emulations do not provide accurate
results for timing evaluation purposes}, especially on Zolertia Z1 motes
\item since the hardware seems to be the main factor influencing this
problem, we suppose its cause is (at least partially) linked to wrong
timing calibrations for microcontrollers' emulation
\item consequently, \emph{we think that all works based on Cooja/MSPSim
simulations to evaluate WSN projects---especially for timing
matters---should be checked (even partially) by tests on actual hardware}
\end{itemize}
\end{alertblock}
\vspace{-0.25cm}
\begin{exampleblock}{How to test the accuracy of your own works?}
\small
We provided the source of our test programs (for Contiki and RIOT OS)
on a public GitHub repository:
\vspace{-0.25cm}
\center{\texttt{https://github.com/rousselk/tim-inacc-tst-prg}}
\end{exampleblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Consequences}

\begin{frame}
\vspace{-0.25cm}
\frametitle{Consequences on WSN Literature}
\begin{block}{What did we find?}
\begin{itemize}
\item many recent publications rely on Cooja/MSPSim to perform, directly
or indirectly, time-related performance evaluations of their WSN-based
projects (fortunately, most of them use the less impacted Sky/TelosB
hardware platform
\cite{Constrain-Routing-Trees-2014} \cite{Co-RPL-2014} \cite{DINAS-2014}
\cite{Efficient-Distrib-Svc-Discovery-2014} \cite{IETF-Routing-WSN-2014}
\cite{TinySDN-2014} \cite{Trickle-L2-2014}
\cite{Visual-Sensor-Networks-2014})
\item most of these papers are focused on higher layers of WSN network
stacks, like routing protocols 
\cite{Constrain-Routing-Trees-2014} \cite{Co-RPL-2014}
\cite{IETF-Routing-WSN-2014} \cite{Trickle-L2-2014}
or application-level projects
\cite{DINAS-2014} \cite{Efficient-Distrib-Svc-Discovery-2014}
\cite{Visual-Sensor-Networks-2014} \cite{Key-Mgmt-2015} \\
$\rightarrow$ \emph{their authors may probably be unaware of this problem,}
since they are not focused on low-level details
\end{itemize}
\end{block}
\vspace{-0.25cm}
\begin{alertblock}{What does that mean?}
Many WSN studies rely (at least partially) on Cooja/MSPSim to evaluate
the time-related performances \\
$\rightarrow$ \emph{This inaccuracy problem could hinder their results,
and thus their conclusions!}
\end{alertblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Conclusions}

\begin{frame}
\frametitle{Conclusions (1/2)}
\vspace{-0.25cm}
\begin{block}{Our contributions}
\begin{itemize}
\item we proved that the Cooja framework is not limited to simulations
of systems running Contiki OS, but can run any program designed for the
emulated architectures (especially MSP430, thanks to MSPSim)
\item we showed that the MSPSim emulation---at least for the version
provided with Contiki release 2.7---suffers from a serious timing inaccuracy
issue; we described the extent of the problem, and provided serious clues
about its cause(s)
\item we briefly enumerated a (limited) list of recent publications,
showing the magnitude of the negative impact this problem can cause
\end{itemize}
\end{block}
\vspace{-0.25cm}
\begin{alertblock}{Our assumption}
Until a fix is made and published to correct this issue in MSPSim,
we believe that tests on actual hardware are the only way to get
reliable results for performance evaluation.
\end{alertblock}
\end{frame}

\begin{frame}
\frametitle{Conclusions (2/2)}
\begin{exampleblock}{In defence of Cooja/MSPSim}
\begin{itemize}
\item the many publications in the domain of WSNs, especially very recent
ones, including Cooja/MSPSim simulations, is a testimony of the usefulness
of such an emulation framework (especially to test large WSNs, which is
often difficult and expensive to with actual hardware) \\
$\rightarrow$ \emph{That's why we strongly believe fixing Cooja/MSPSim
is really important, and hope for such a fix to appear soon}
\item while the issue described can impair the use of Cooja/MSPSim as
a performance evaluation tool, \emph{it does not affect its other useful
applications, like the ability to develop and debug WSN-related software
much more easily thanks to its emulation features}
\end{itemize}
\end{exampleblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix

%%% ANNEXE : REMERCIEMENTS ET RÉFÉRENCES BIBLIOGRAPHIQUES

\section{Appendix}

\begin{frame}
\frametitle{Acknowledgements}
\begin{columns}[c]
\begin{column}{8.25cm}
\begin{block}{Funding}
This work has been funded by the French national PIA\footnote{\textsl{PIA~:
\guillemotleft~Programme d'investissement d'avenir~\guillemotright}}
\textbf{LAR} (\textit{``Living Assistant Robot''}).
\end{block}
\end{column}
\end{columns}
\end{frame}

\begin{frame}
\frametitle{References}
\bibliographystyle{unsrt}
\bibliography{TimingInacc}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%                               80 COLONNES                                %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% FIN DE LA PRÉSENTATION
\end{document}


